#!/usr/bin/env bash
set -euo pipefail

PORT="${1:-}"  # si tu prÃ©cises un port, on le cible

# 1) Essai ciblÃ© (process dÃ©marrÃ© par uvicorn avec backend.main:app)
pkill -f 'uvicorn.*backend\.main:app' && echo "âœ… Uvicorn backend.main arrÃªtÃ© (pattern)" || true

# 2) Si un port est fourni, tue ce qui Ã©coute dessus
if [[ -n "${PORT}" ]]; then
  PIDS=$(lsof -tiTCP:"$PORT" -sTCP:LISTEN || true)
  if [[ -n "$PIDS" ]]; then
    echo "âš ï¸  Process sur port $PORT : $PIDS â†’ kill"
    kill $PIDS 2>/dev/null || kill -9 $PIDS 2>/dev/null || true
  fi
fi

echo "ğŸ›‘ TerminÃ©."
